---
## Author
author:
  name: Арсений Валерьевич Агаев
  email: 1032221668@rudn.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: Лабораторная работа №9
subtitle: Настройка POP3/IMAP сервера
license: CC BY
date: today
date-format: "YYYY-MM-DD" # Example: 2025-09-06
---

# Информация

## Докладчик

:::::::::::::: {.columns align=center}
::: {.column width="70%"}

  * Арсений Валерьевич Агаев
  * студент
  * Российский университет дружбы народов им. П. Лумумбы
  * [1032221668@rudn.ru](mailto:1032221668@rudn.ru)

:::
::: {.column width="30%"}

:::
::::::::::::::


# Цели и задачи

Приобретение практических навыков по установке и простейшему конфигурированию POP3/IMAP-сервера.

- Установить на виртуальной машине ```server``` Dovecot и Telnet для дальнейшей проверки корректности работы почтового сервера.

- Настройка Dovecot.

- Установить на виртуальной машине ```client``` программу Evolution и настроить её. Проверить корректность работы почтового сервера как с виртуальной машины ```server```, так и с виртуальной машины ```client```.

- Изменить скрипт для Vagrant, фиксирующий действия лаборатоной работы во внутреннем окружении виртуальных машин ```server``` и ```client```. Соотвествующим образом внести изменения в Vagrantfile.

# Содержание исследования

## Настройка Dovecot

После установки Dovecot необходимо внести изменения в файлы. А именно
файл ```/etc/dovecot/dovecot.conf``:

```conf
protocols = imap pop3
```

## Настройка Dovecot

Файл ```/etc/dovecot/conf.d/10-auth.conf```:

```conf
auth_mechanisms = plain
```

## Настройка Dovecot

Файл ```/etc/dovecot/conf.d/auth-system.conf.ext```:

```conf
passdb {
  driver = pam
}
userdb {
  driver = passwd
}
```

## Настройка Dovecot

Файл ```/etc/dovecot/conf.d/10-mail.conf```:

```conf
mail_location = maildir:~/Maildir
```

## Каталог доставки почты Postfix

После задать каталог в Postfix для доставки почты

```
postconf -e 'home_mailbox = Maildir/'
```

## Настройка firewalld

Добавить необходимые сервисы в firewalld:

```
firewall-cmd --add-service=pop3 --permanent
firewall-cmd --add-service=pop3s --permanent
firewall-cmd --add-service=imap --permanent
firewall-cmd --add-service=imaps --permanent
firewall-cmd --reload
```

## Восстановление контекста безопасности и перезапуск сервисов

Восстановить контекст безопасности в SELinux:

```
restorecon -vR /etc
```

И перезапускаю Postfix и запускаю Dovecot:

```
systemctl restart postfix
systemctl enable dovecot
systemctl start dovecot
```

## Мониторинг почтовой службы

В дополнительном терминале виртуальной машины ```server``` я запускаю мониторинг работы почтовой службы:

```
tail -f /var/log/maillog
```

![Мониторинг работы почтовой службы](image/2.png){#fig-002 width=70%}

## Настройка Evolution

![Настройка Evolution. Имя и почта](image/4.png){#fig-004 width=70%}

## Настройка Evolution

![Настройка Evolution. IMAP](image/5.png){#fig-005 width=70%}

## Настройка Evolution

![Настройка Evolution. SMTP](image/6.png){#fig-006 width=70%}

## Отправка сообщения

Далее отправляю тестовые писма

![Отправка тестовых сообщений](image/7.png){#fig-007 width=70%}

## Проверка сообщений почтовой службы на сервере

Проверяю сообщения почтовой службы на сервере

![Просмотр сообщений на сервере](image/8.png){#fig-008 width=70%}

## Проверка работы с помощью протокола Telnet

![Работа через Telnet](image/9.png){#fig-009 width=70%}

## Фиксация изменений в настройках внутреннего окружения виртуальной машины

Проделываю данные манипуляции в каталоге ```/vagrant/provision/server```

```
mkdir -p /vagrant/provision/server/mail/etc/dovecot/conf.d
cp -R /etc/dovecot/dovecot.conf /vagrant/provision/server/mail/etc/dovecot/
cp -R /etc/dovecot/conf.d/10-auth.conf /vagrant/provision/server/mail/etc/dovecot/conf.d/
cp -R /etc/dovecot/conf.d/auth-system.conf.ext /vagrant/provision/server/mail/etc/dovecot/conf.d/
cp -R /etc/dovecot/conf.d/10-mail.conf /vagrant/provision/server/mail/etc/dovecot/conf.d/
```

## Фиксация изменений в настройках внутреннего окружения виртуальной машины

Внес изменения в файл ```/vagrant/provision/server/mail.sh```.
Добавил:

```
...
dnf -y install dovecot
dnf -y install telnet
...
firewall-cmd --add-service=pop3 --permanent
firewall-cmd --add-service=pop3s --permanent
firewall-cmd --add-service=imap --permanent
firewall-cmd --add-service=imaps --permanent
...
postconf -e 'home_mailbox = Maildir/'
...
systemctl enable dovecot
systemctl start dovecot
```

## Фиксация изменений в настройках внутреннего окружения виртуальной машины

На виртуальной машине ```client``` добавил установку Evolution в файл 
```/vagrant/provision/client/mail.sh```:

```
...
dnf -y install evolution
...
```

# Результаты

Я успешно приобрел практические навыки по установке и простейшему конфигурированию POP3/IMAP-сервера.

